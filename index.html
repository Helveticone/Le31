<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Caf√© Bar le 31 - Smash Burgers</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Arial, sans-serif; background: #fff; padding-bottom: 100px; }
        .header { background: #000; color: #fff; padding: 20px; text-align: center; }
        .header img { width: 100px; height: 100px; border-radius: 50%; background: #fff; object-fit: contain; display: block; margin: 0 auto 10px; border: 3px solid #fff; }
        .nav { display: flex; gap: 10px; padding: 15px; overflow-x: auto; background: #fff; position: sticky; top: 0; z-index: 100; border-bottom: 2px solid #000; }
        .nav button { padding: 12px 20px; border: 2px solid #000; background: #fff; border-radius: 25px; font-weight: bold; cursor: pointer; white-space: nowrap; }
        .nav button.active { background: #000; color: #fff; }
        .container { max-width: 600px; margin: 0 auto; padding: 20px; }
        .category { display: none; }
        .category.active { display: block; }
        .item { border: 2px solid #000; border-radius: 10px; padding: 15px; margin-bottom: 15px; }
        .item h3 { margin-bottom: 5px; }
        .price { font-weight: bold; font-size: 18px; margin: 10px 0; }
        
        .check-line { 
            display: flex; 
            align-items: center; 
            padding: 12px; 
            border: 2px solid #000; 
            border-radius: 8px; 
            margin: 8px 0; 
            cursor: pointer; 
            background: #fff;
        }
        .check-line.checked { background: #000; color: #fff; }
        .check-line input[type="checkbox"] { 
            width: 20px; 
            height: 20px; 
            margin-right: 10px; 
            cursor: pointer;
        }
        .check-line .txt { flex: 1; display: flex; justify-content: space-between; pointer-events: none; }
        
        .radio-group { display: flex; gap: 10px; margin: 10px 0; }
        .radio-btn { 
            flex: 1; 
            padding: 10px; 
            border: 2px solid #000; 
            border-radius: 8px; 
            text-align: center; 
            cursor: pointer;
            background: #fff;
        }
        .radio-btn.selected { background: #000; color: #fff; }
        .frites-box { display: none; margin: 10px 0; padding: 10px; background: #f5f5f5; border-radius: 8px; }
        .frites-box.show { display: block; }
        
        .qty-control { display: flex; align-items: center; gap: 10px; margin-top: 10px; }
        .qty-control button { width: 35px; height: 35px; border-radius: 50%; border: 2px solid #000; background: #000; color: #fff; font-size: 18px; cursor: pointer; }
        .qty-control button:disabled { background: #ccc; border-color: #ccc; }
        .qty-control span { min-width: 30px; text-align: center; font-weight: bold; }
        
        .cart { position: fixed; bottom: 0; left: 0; right: 0; background: #fff; padding: 15px; border-top: 3px solid #000; display: flex; justify-content: space-between; align-items: center; z-index: 1000; }
        .cart button { background: #000; color: #fff; border: none; padding: 15px 25px; border-radius: 25px; font-weight: bold; font-size: 16px; cursor: pointer; }
        .cart button:disabled { background: #ccc; }
        
        #orderModal { display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.5); z-index: 2000; align-items: flex-end; justify-content: center; }
        #orderModal.show { display: flex; }
        .modal-content { background: #fff; width: 100%; max-width: 500px; max-height: 90vh; overflow-y: auto; border-radius: 20px 20px 0 0; padding: 20px; }
        .section-title { font-weight: bold; margin: 15px 0 8px; padding-bottom: 5px; border-bottom: 1px solid #000; text-transform: uppercase; font-size: 14px; }
        input, select, textarea { width: 100%; padding: 12px; border: 2px solid #000; border-radius: 8px; margin: 5px 0; font-size: 16px; }
        .btn-primary { width: 100%; background: #000; color: #fff; border: none; padding: 16px; border-radius: 25px; font-size: 16px; font-weight: bold; margin-top: 10px; cursor: pointer; }
        .btn-secondary { width: 100%; background: #fff; color: #000; border: 2px solid #000; padding: 12px; border-radius: 25px; font-size: 14px; font-weight: bold; margin-top: 10px; cursor: pointer; }
        .badge { display: inline-block; background: #fff; color: #000; padding: 5px 10px; border-radius: 15px; font-size: 12px; border: 2px solid #000; margin: 2px; }
        
        /* Style pour les lignes du panier */
        .cart-item { 
            display: flex; 
            justify-content: space-between; 
            align-items: flex-start;
            padding: 10px; 
            border-bottom: 1px solid #ddd; 
            margin-bottom: 5px;
        }
        .cart-item-info { flex: 1; }
        .cart-item-actions { display: flex; gap: 10px; align-items: center; }
        .cart-item button.delete { 
            background: #ff4444; 
            color: #fff; 
            border: none; 
            width: 25px; 
            height: 25px; 
            border-radius: 50%; 
            cursor: pointer;
            font-size: 12px;
        }
        .cart-item button.edit { 
            background: #000; 
            color: #fff; 
            border: none; 
            padding: 5px 10px; 
            border-radius: 15px; 
            cursor: pointer;
            font-size: 12px;
        }
    </style>
</head>
<body>
    <div class="header">
        <img src="https://raw.githubusercontent.com/Helveticonc/Le31/main/logo-officiel.png" alt="Logo Caf√© Bar le 31" style="width:100px;height:100px;border-radius:50%;background:#fff;object-fit:contain;display:block;margin:0 auto 10px;border:3px solid #fff;">
        <h1>Le 31</h1>
        <p>Smash Burgers ‚Ä¢ √Ä emporter</p>
        <div>
            <span class="badge">üçî Smash Burgers</span>
            <span class="badge">üìç Avenue de la Gare 31</span>
        </div>
    </div>

    <div class="nav">
        <button class="active" onclick="showCat('burgers', this)">üçî Burgers</button>
        <button onclick="showCat('menus', this)">üéì Menu √âtudiant</button>
        <button onclick="showCat('desserts', this)">üç∞ Desserts</button>
    </div>

    <div class="container">
        <div id="burgers" class="category active"></div>
        <div id="menus" class="category"></div>
        <div id="desserts" class="category"></div>
    </div>

    <div class="cart">
        <div>
            <small id="cart-count">0 article</small><br>
            <strong>Total: <span id="cart-total">0.00</span> CHF</strong>
        </div>
        <button onclick="openOrder()" id="order-btn" disabled>üì± Commander</button>
    </div>

    <div id="orderModal" onclick="if(event.target.id=='orderModal')closeOrder()">
        <div class="modal-content">
            <h2>üìù Votre commande</h2>
            <div id="order-list" style="background:#f5f5f5;padding:15px;border-radius:8px;margin:15px 0;max-height:300px;overflow-y:auto;"></div>
            
            <button class="btn-secondary" onclick="closeOrder()">‚ûï Ajouter d'autres articles</button>
            
            <div style="margin-top: 15px; padding-top: 15px; border-top: 2px solid #000;">
                <div class="form-group">
                    <label>Nom et pr√©nom *</label>
                    <input type="text" id="name" placeholder="Jean Dupont">
                </div>
                <div class="form-group">
                    <label>T√©l√©phone *</label>
                    <input type="tel" id="phone" placeholder="079 123 45 67">
                </div>
                <div class="form-group">
                    <label>Date et heure de retrait *</label>
                    <div style="display:flex;gap:10px;">
                        <input type="date" id="delivery-date" onchange="updateTimes()" style="flex:1;">
                        <select id="delivery-time" style="flex:1;"><option value="">Choisir</option></select>
                    </div>
                </div>
                <div class="form-group">
                    <label>Commentaires</label>
                    <textarea id="notes" rows="2" placeholder="Allergies..."></textarea>
                </div>
                <button class="btn-primary" onclick="sendOrder()">üì≤ Confirmer par WhatsApp</button>
            </div>
        </div>
    </div>

    <script>
        // DONN√âES
        var burgers = [
            {n: "Smash Burger M", d: "1 steak Smash", p: 11},
            {n: "Smash Burger L", d: "2 steaks Smash", p: 13},
            {n: "Smash Burger XL", d: "3 steaks Smash", p: 15}
        ];
        var supplements = [
            {id: 'bacon', n: 'Bacon', p: 2.5},
            {id: 'oeuf', n: 'Oeuf', p: 2.5},
            {id: 'avocat', n: 'Avocat', p: 2.5}
        ];
        
        // √âTAT - Chaque ligne du panier est ind√©pendante
        var cart = []; // Tableau d'objets : {id: unique, type: 'b0', opts: {menu, frites, supps: []}}
        var currentEditId = null; // Pour √©diter une ligne existante
        
        // INITIALISATION
        function init() {
            renderBurgers();
            renderMenus();
            renderDesserts();
            initDate();
        }
        
        function renderBurgers() {
            var html = '<div style="background:#fff;border:2px solid #000;padding:10px;margin-bottom:15px;border-radius:8px;">ü•© Chaque burger: cheddar, oignons caram√©lis√©s, sauce maison</div>';
            
            for (var i = 0; i < burgers.length; i++) {
                var b = burgers[i];
                var id = 'b' + i;
                html += '<div class="item">';
                html += '<h3>' + b.n + '</h3>';
                html += '<p>' + b.d + '</p>';
                html += '<div class="price">' + b.p.toFixed(2) + ' CHF</div>';
                
                // SUPPL√âMENTS (en premier)
                html += '<div class="section-title">‚ûï Suppl√©ments</div>';
                for (var s = 0; s < supplements.length; s++) {
                    var sup = supplements[s];
                    html += '<div class="check-line" id="supp-line-' + id + '-' + sup.id + '" onclick="toggleSupp(\'' + id + '\', \'' + sup.id + '\')">';
                    html += '<input type="checkbox" id="supp-check-' + id + '-' + sup.id + '" onclick="event.stopPropagation()">';
                    html += '<div class="txt"><span>' + sup.n + '</span><span>+' + sup.p.toFixed(2) + ' CHF</span></div>';
                    html += '</div>';
                }
                
                // MENU (apr√®s suppl√©ments)
                html += '<div class="section-title">üçü Menu (+5 CHF)</div>';
                html += '<div class="check-line" id="menu-line-' + id + '" onclick="toggleMenu(\'' + id + '\')">';
                html += '<input type="checkbox" id="menu-check-' + id + '" onclick="event.stopPropagation()">';
                html += '<div class="txt"><span>Ajouter Menu</span><span>+5 CHF</span></div>';
                html += '</div>';
                
                // FRITES
                html += '<div class="frites-box" id="frites-box-' + id + '">';
                html += '<div style="font-weight:bold;margin-bottom:8px;">Frites:</div>';
                html += '<div class="radio-group">';
                html += '<div class="radio-btn" onclick="setFrites(\'' + id + '\', \'pomme\')" id="radio-pomme-' + id + '">ü•î Normales</div>';
                html += '<div class="radio-btn" onclick="setFrites(\'' + id + '\', \'patate\')" id="radio-patate-' + id + '">üç† Douces</div>';
                html += '</div>';
                html += '</div>';
                
                // BOUTON AJOUTER AU PANIER (au lieu de +/-)
                html += '<button class="btn-primary" onclick="addToCart(\'' + id + '\')" style="margin-top:15px;">üõí Ajouter au panier</button>';
                
                html += '</div>';
            }
            
            document.getElementById('burgers').innerHTML = html;
        }
        
        function renderMenus() {
            var html = '<div style="background:#fff;border:2px solid #000;padding:10px;margin-bottom:15px;border-radius:8px;">üéì Sur pr√©sentation de votre carte √©tudiante uniquement</div>';
            html += renderSimpleItem('me0', 'Menu √âtudiant M', 'Burger M + frites + soft 3dl', 14);
            html += renderSimpleItem('me1', 'Menu √âtudiant L', 'Burger L + frites + soft 3dl', 16);
            document.getElementById('menus').innerHTML = html;
        }
        
        function renderDesserts() {
            var html = '';
            html += renderSimpleItem('d0', 'Tiramisu Classique', 'Le classique italien', 6);
            html += renderSimpleItem('d1', 'Tiramisu Speculoos', 'Au go√ªt de speculoos', 6);
            html += renderSimpleItem('d2', 'Tiramisu Oreo', 'Aux biscuits Oreo', 6);
            document.getElementById('desserts').innerHTML = html;
        }
        
        function renderSimpleItem(id, name, desc, price) {
            var html = '<div class="item">';
            html += '<h3>' + name + '</h3>';
            html += '<p>' + desc + '</p>';
            html += '<div class="price">' + price.toFixed(2) + ' CHF</div>';
            html += '<button class="btn-primary" onclick="addSimpleToCart(\'' + id + '\', \'' + name + '\', ' + price + ')" style="margin-top:10px;">üõí Ajouter au panier</button>';
            html += '</div>';
            return html;
        }
        
        // GESTION DES OPTIONS (s√©lection visuelle uniquement, pas encore dans le panier)
        function toggleMenu(itemType) {
            var cb = document.getElementById('menu-check-' + itemType);
            cb.checked = !cb.checked;
            updateMenuVisual(itemType);
        }
        
        function updateMenuVisual(itemType) {
            var cb = document.getElementById('menu-check-' + itemType);
            var line = document.getElementById('menu-line-' + itemType);
            var fritesBox = document.getElementById('frites-box-' + itemType);
            
            if (cb.checked) {
                line.classList.add('checked');
                fritesBox.classList.add('show');
            } else {
                line.classList.remove('checked');
                fritesBox.classList.remove('show');
                document.getElementById('radio-pomme-' + itemType).classList.remove('selected');
                document.getElementById('radio-patate-' + itemType).classList.remove('selected');
            }
        }
        
        function setFrites(itemType, type) {
            // V√©rifier si menu est coch√©
            if (!document.getElementById('menu-check-' + itemType).checked) return;
            
            document.getElementById('radio-pomme-' + itemType).classList.remove('selected');
            document.getElementById('radio-patate-' + itemType).classList.remove('selected');
            document.getElementById('radio-' + type + '-' + itemType).classList.add('selected');
        }
        
        function toggleSupp(itemType, supId) {
            var cb = document.getElementById('supp-check-' + itemType + '-' + supId);
            cb.checked = !cb.checked;
            updateSuppVisual(itemType, supId);
        }
        
        function updateSuppVisual(itemType, supId) {
            var cb = document.getElementById('supp-check-' + itemType + '-' + supId);
            var line = document.getElementById('supp-line-' + itemType + '-' + supId);
            
            if (cb.checked) {
                line.classList.add('checked');
            } else {
                line.classList.remove('checked');
            }
        }
        
        // AJOUT AU PANIER
        function addToCart(itemType) {
            var opts = {
                menu: document.getElementById('menu-check-' + itemType).checked,
                frites: null,
                supps: []
            };
            
            if (opts.menu) {
                if (document.getElementById('radio-pomme-' + itemType).classList.contains('selected')) {
                    opts.frites = 'pomme';
                } else if (document.getElementById('radio-patate-' + itemType).classList.contains('selected')) {
                    opts.frites = 'patate';
                }
            }
            
            for (var i = 0; i < supplements.length; i++) {
                var supId = supplements[i].id;
                if (document.getElementById('supp-check-' + itemType + '-' + supId).checked) {
                    opts.supps.push(supId);
                }
            }
            
            // Ajouter au panier avec ID unique
            var cartItem = {
                id: Date.now() + '-' + Math.random().toString(36).substr(2, 9),
                type: itemType,
                opts: opts
            };
            
            cart.push(cartItem);
            
            // Reset visuel
            resetItemVisual(itemType);
            
            updateCartDisplay();
            
            // Feedback visuel
            alert('‚úÖ Article ajout√© au panier !');
        }
        
        function addSimpleToCart(type, name, price) {
            cart.push({
                id: Date.now() + '-' + Math.random().toString(36).substr(2, 9),
                type: type,
                opts: {menu: false, frites: null, supps: []},
                name: name,
                price: price
            });
            updateCartDisplay();
            alert('‚úÖ ' + name + ' ajout√© au panier !');
        }
        
        function resetItemVisual(itemType) {
            // Reset menu
            document.getElementById('menu-check-' + itemType).checked = false;
            document.getElementById('menu-line-' + itemType).classList.remove('checked');
            document.getElementById('frites-box-' + itemType).classList.remove('show');
            document.getElementById('radio-pomme-' + itemType).classList.remove('selected');
            document.getElementById('radio-patate-' + itemType).classList.remove('selected');
            
            // Reset supps
            for (var i = 0; i < supplements.length; i++) {
                var supId = supplements[i].id;
                document.getElementById('supp-check-' + itemType + '-' + supId).checked = false;
                document.getElementById('supp-line-' + itemType + '-' + supId).classList.remove('checked');
            }
        }
        
        function removeFromCart(cartItemId) {
            cart = cart.filter(function(item) { return item.id !== cartItemId; });
            updateCartDisplay();
            if (cart.length === 0) {
                closeOrder();
            } else {
                openOrder(); // Refresh
            }
        }
        
        function updateCartDisplay() {
            var total = 0;
            var count = cart.length;
            
            for (var i = 0; i < cart.length; i++) {
                var item = cart[i];
                var price = getItemPrice(item);
                total += price;
            }
            
            document.getElementById('cart-total').textContent = total.toFixed(2);
            document.getElementById('cart-count').textContent = count + (count > 1 ? ' articles' : ' article');
            document.getElementById('order-btn').disabled = (count === 0);
        }
        
        function getItemPrice(cartItem) {
            var basePrice = 0;
            var type = cartItem.type;
            
            if (type.startsWith('b')) {
                basePrice = burgers[parseInt(type.substring(1))].p;
            } else if (type.startsWith('me')) {
                basePrice = (type === 'me0') ? 14 : 16;
            } else if (type.startsWith('d')) {
                basePrice = 6;
            } else if (cartItem.price) {
                basePrice = cartItem.price;
            }
            
            var total = basePrice;
            
            if (cartItem.opts.menu) total += 5;
            for (var i = 0; i < cartItem.opts.supps.length; i++) {
                var sup = supplements.find(function(s) { return s.id === cartItem.opts.supps[i]; });
                if (sup) total += sup.p;
            }
            
            return total;
        }
        
        function getItemName(cartItem) {
            if (cartItem.name) return cartItem.name;
            
            var type = cartItem.type;
            if (type.startsWith('b')) return burgers[parseInt(type.substring(1))].n;
            if (type === 'me0') return 'Menu √âtudiant M';
            if (type === 'me1') return 'Menu √âtudiant L';
            if (type === 'd0') return 'Tiramisu Classique';
            if (type === 'd1') return 'Tiramisu Speculoos';
            if (type === 'd2') return 'Tiramisu Oreo';
            return 'Article';
        }
        
        function showCat(cat, btn) {
            document.querySelectorAll('.category').forEach(function(el) { el.classList.remove('active'); });
            document.getElementById(cat).classList.add('active');
            document.querySelectorAll('.nav button').forEach(function(el) { el.classList.remove('active'); });
            btn.classList.add('active');
        }
        
        function initDate() {
            var today = new Date();
            document.getElementById('delivery-date').valueAsDate = today;
            updateTimes();
        }
        
        function updateTimes() {
            var date = document.getElementById('delivery-date').value;
            var sel = document.getElementById('delivery-time');
            sel.innerHTML = '<option value="">Choisir</option>';
            if (!date) return;
            
            var d = new Date(date);
            var now = new Date();
            var isToday = d.toDateString() === now.toDateString();
            
            var slots = ['11:30', '11:45', '12:00', '12:15', '12:30', '12:45', '13:00', '13:15', '13:30', '13:45', '14:00'];
            
            if (isToday) {
                var minTime = new Date(now.getTime() + 45 * 60000);
                var minHour = minTime.getHours();
                var minMin = minTime.getMinutes();
                slots = slots.filter(function(t) {
                    var parts = t.split(':');
                    var h = parseInt(parts[0]);
                    var m = parseInt(parts[1]);
                    return h > minHour || (h === minHour && m >= minMin);
                });
            }
            
            slots.forEach(function(t) {
                var opt = document.createElement('option');
                opt.value = t;
                opt.textContent = t;
                sel.appendChild(opt);
            });
        }
        
        function openOrder() {
            updateTimes();
            var html = '';
            var total = 0;
            
            for (var i = 0; i < cart.length; i++) {
                var item = cart[i];
                var price = getItemPrice(item);
                var name = getItemName(item);
                var details = [];
                
                if (item.opts.menu) {
                    details.push('Menu + frites ' + (item.opts.frites === 'patate' ? 'douces' : 'normales'));
                }
                if (item.opts.supps.length > 0) {
                    var snames = item.opts.supps.map(function(sid) {
                        var s = supplements.find(function(x) { return x.id === sid; });
                        return s ? s.n : '';
                    });
                    details.push('+' + snames.join(', '));
                }
                
                total += price;
                
                html += '<div class="cart-item">';
                html += '<div class="cart-item-info">';
                html += '<strong>' + name + '</strong>';
                if (details.length > 0) {
                    html += '<br><small>' + details.join(' | ') + '</small>';
                }
                html += '<br><strong>' + price.toFixed(2) + ' CHF</strong>';
                html += '</div>';
                html += '<div class="cart-item-actions">';
                html += '<button class="delete" onclick="removeFromCart(\'' + item.id + '\')">‚úï</button>';
                html += '</div>';
                html += '</div>';
            }
            
            html += '<div style="display:flex;justify-content:space-between;padding:15px 0;margin-top:10px;border-top:2px solid #000;font-weight:bold;font-size:18px;">';
            html += '<span>TOTAL</span><span>' + total.toFixed(2) + ' CHF</span></div>';
            
            document.getElementById('order-list').innerHTML = html;
            document.getElementById('orderModal').classList.add('show');
        }
        
        function closeOrder() {
            document.getElementById('orderModal').classList.remove('show');
        }
        
        function sendOrder() {
            var name = document.getElementById('name').value.trim();
            var phone = document.getElementById('phone').value.trim();
            var date = document.getElementById('delivery-date').value;
            var time = document.getElementById('delivery-time').value;
            var notes = document.getElementById('notes').value.trim();
            
            if (!name || !phone) { alert('Veuillez remplir le nom et t√©l√©phone'); return; }
            if (!date || !time) { alert('Veuillez choisir la date et l\'heure'); return; }
            
            var msg = 'üçî *COMMANDE CAFE BAR LE 31*\n\n';
            msg += 'üë§ ' + name + '\n';
            msg += 'üìû ' + phone + '\n';
            msg += 'üìÖ ' + date + ' √† ' + time + '\n';
            msg += 'üìç Avenue de la Gare 31, 2800 Del√©mont\n\n';
            msg += '*Commande:*\n';
            
            var total = 0;
            for (var i = 0; i < cart.length; i++) {
                var item = cart[i];
                var lineTotal = getItemPrice(item);
                var itemName = getItemName(item);
                
                msg += '‚Ä¢ ' + itemName;
                
                if (item.opts.menu) {
                    msg += ' +Menu(' + (item.opts.frites === 'patate' ? 'douces' : 'normales') + ')';
                }
                if (item.opts.supps.length > 0) {
                    msg += ' +' + item.opts.supps.join(',');
                }
                
                msg += ' = ' + lineTotal.toFixed(2) + ' CHF\n';
                total += lineTotal;
            }
            
            msg += '\nüí∞ *TOTAL: ' + total.toFixed(2) + ' CHF*';
            if (notes) msg += '\n\nüìù ' + notes;
            
            window.open('https://wa.me/41783280311?text= ' + encodeURIComponent(msg), '_blank');
            
            // Reset
            cart = [];
            updateCartDisplay();
            closeOrder();
            document.getElementById('name').value = '';
            document.getElementById('phone').value = '';
            document.getElementById('notes').value = '';
        }
        
        init();
    </script>
</body>
</html>
