<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Caf√© Bar le 31 - Smash Burgers</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Arial, sans-serif; background: #fff; padding-bottom: 100px; }
        .header { background: #000; color: #fff; padding: 20px; text-align: center; }
        .header img { width: 100px; height: 100px; border-radius: 50%; background: #fff; object-fit: cover; display: block; margin: 0 auto 10px; }
        .nav { display: flex; gap: 10px; padding: 15px; overflow-x: auto; background: #fff; position: sticky; top: 0; z-index: 100; border-bottom: 2px solid #000; }
        .nav button { padding: 12px 20px; border: 2px solid #000; background: #fff; border-radius: 25px; font-weight: bold; cursor: pointer; white-space: nowrap; }
        .nav button.active { background: #000; color: #fff; }
        .container { max-width: 600px; margin: 0 auto; padding: 20px; }
        .category { display: none; }
        .category.active { display: block; }
        .item { border: 2px solid #000; border-radius: 10px; padding: 15px; margin-bottom: 15px; }
        .item h3 { margin-bottom: 5px; }
        .price { font-weight: bold; font-size: 18px; margin: 10px 0; }
        
        /* CHECKBOX SIMPLE - FONCTIONNE PARTOUT */
        .check-line { 
            display: flex; 
            align-items: center; 
            padding: 12px; 
            border: 2px solid #000; 
            border-radius: 8px; 
            margin: 8px 0; 
            cursor: pointer; 
            background: #fff;
        }
        .check-line.checked { background: #000; color: #fff; }
        .check-line input[type="checkbox"] { 
            width: 20px; 
            height: 20px; 
            margin-right: 10px; 
            cursor: pointer;
        }
        .check-line .txt { flex: 1; display: flex; justify-content: space-between; pointer-events: none; }
        
        .radio-group { display: flex; gap: 10px; margin: 10px 0; }
        .radio-btn { 
            flex: 1; 
            padding: 10px; 
            border: 2px solid #000; 
            border-radius: 8px; 
            text-align: center; 
            cursor: pointer;
            background: #fff;
        }
        .radio-btn.selected { background: #000; color: #fff; }
        .frites-box { display: none; margin: 10px 0; padding: 10px; background: #f5f5f5; border-radius: 8px; }
        .frites-box.show { display: block; }
        
        .qty-control { display: flex; align-items: center; gap: 10px; margin-top: 10px; }
        .qty-control button { width: 35px; height: 35px; border-radius: 50%; border: 2px solid #000; background: #000; color: #fff; font-size: 18px; cursor: pointer; }
        .qty-control button:disabled { background: #ccc; border-color: #ccc; }
        .qty-control span { min-width: 30px; text-align: center; font-weight: bold; }
        
        .cart { position: fixed; bottom: 0; left: 0; right: 0; background: #fff; padding: 15px; border-top: 3px solid #000; display: flex; justify-content: space-between; align-items: center; z-index: 1000; }
        .cart button { background: #000; color: #fff; border: none; padding: 15px 25px; border-radius: 25px; font-weight: bold; font-size: 16px; cursor: pointer; }
        .cart button:disabled { background: #ccc; }
        
        #orderModal { display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.5); z-index: 2000; align-items: flex-end; justify-content: center; }
        #orderModal.show { display: flex; }
        .modal-content { background: #fff; width: 100%; max-width: 500px; max-height: 90vh; overflow-y: auto; border-radius: 20px 20px 0 0; padding: 20px; }
        .section-title { font-weight: bold; margin: 15px 0 8px; padding-bottom: 5px; border-bottom: 1px solid #000; text-transform: uppercase; font-size: 14px; }
        input, select, textarea { width: 100%; padding: 12px; border: 2px solid #000; border-radius: 8px; margin: 5px 0; font-size: 16px; }
        .btn-primary { width: 100%; background: #000; color: #fff; border: none; padding: 16px; border-radius: 25px; font-size: 16px; font-weight: bold; margin-top: 10px; cursor: pointer; }
        .badge { display: inline-block; background: #fff; color: #000; padding: 5px 10px; border-radius: 15px; font-size: 12px; border: 2px solid #000; margin: 2px; }
    </style>
</head>
<body>
    <div class="header">
        <img src="logo-officiel.png" alt="Logo" onerror="this.style.display='none'">
        <h1>Caf√© Bar le 31</h1>
        <p>Smash Burgers ‚Ä¢ √Ä emporter</p>
        <div>
            <span class="badge">üçî Smash Burgers</span>
            <span class="badge">üìç Avenue de la Gare 31</span>
        </div>
    </div>

    <div class="nav">
        <button class="active" onclick="showCat('burgers', this)">üçî Burgers</button>
        <button onclick="showCat('menus', this)">üéì Menu √âtudiant</button>
        <button onclick="showCat('desserts', this)">üç∞ Desserts</button>
    </div>

    <div class="container">
        <div id="burgers" class="category active"></div>
        <div id="menus" class="category"></div>
        <div id="desserts" class="category"></div>
    </div>

    <div class="cart">
        <div>
            <small id="cart-count">0 article</small><br>
            <strong>Total: <span id="cart-total">0.00</span> CHF</strong>
        </div>
        <button onclick="openOrder()" id="order-btn" disabled>üì± Commander</button>
    </div>

    <div id="orderModal" onclick="if(event.target.id=='orderModal')closeOrder()">
        <div class="modal-content">
            <h2>üìù Votre commande</h2>
            <div id="order-list" style="background:#f5f5f5;padding:15px;border-radius:8px;margin:15px 0;max-height:200px;overflow-y:auto;"></div>
            <div>
                <label>Nom et pr√©nom *</label>
                <input type="text" id="name" placeholder="Jean Dupont">
            </div>
            <div>
                <label>T√©l√©phone *</label>
                <input type="tel" id="phone" placeholder="079 123 45 67">
            </div>
            <div>
                <label>Date et heure de retrait *</label>
                <div style="display:flex;gap:10px;">
                    <input type="date" id="delivery-date" onchange="updateTimes()" style="flex:1;">
                    <select id="delivery-time" style="flex:1;"><option value="">Choisir</option></select>
                </div>
            </div>
            <div>
                <label>Commentaires</label>
                <textarea id="notes" rows="2" placeholder="Allergies..."></textarea>
            </div>
            <button class="btn-primary" onclick="sendOrder()">üì≤ Confirmer par WhatsApp</button>
        </div>
    </div>

    <script>
        // DONN√âES
        var burgers = [
            {n: "Smash Burger M", d: "1 steak Smash", p: 11},
            {n: "Smash Burger L", d: "2 steaks Smash", p: 13},
            {n: "Smash Burger XL", d: "3 steaks Smash", p: 15}
        ];
        var supplements = [
            {id: 'bacon', n: 'Bacon', p: 2.5},
            {id: 'oeuf', n: 'Oeuf', p: 2.5},
            {id: 'avocat', n: 'Avocat', p: 2.5}
        ];
        
        // √âTAT
        var cart = {};
        var opts = {}; // options: {itemId: {menu: bool, frites: string, supps: []}}
        
        // INITIALISATION
        function init() {
            var html = '<div style="background:#fff;border:2px solid #000;padding:10px;margin-bottom:15px;border-radius:8px;">ü•© Chaque burger: cheddar, oignons caram√©lis√©s, sauce maison</div>';
            
            for (var i = 0; i < burgers.length; i++) {
                var b = burgers[i];
                var id = 'b' + i;
                html += '<div class="item">';
                html += '<h3>' + b.n + '</h3>';
                html += '<p>' + b.d + '</p>';
                html += '<div class="price">' + b.p.toFixed(2) + ' CHF</div>';
                
                // MENU
                html += '<div class="section-title">üçü Menu (+5 CHF)</div>';
                html += '<div class="check-line" onclick="toggleMenu(\'' + id + '\')">';
                html += '<input type="checkbox" id="m-' + id + '" onclick="event.stopPropagation()">';
                html += '<div class="txt"><span>Ajouter Menu</span><span>+5 CHF</span></div>';
                html += '</div>';
                
                // FRITES (cach√© par d√©faut)
                html += '<div class="frites-box" id="f-' + id + '">';
                html += '<div style="font-weight:bold;margin-bottom:8px;">Frites:</div>';
                html += '<div class="radio-group">';
                html += '<div class="radio-btn" onclick="setFrites(\'' + id + '\', \'pomme\')" id="fp-' + id + '">ü•î Normales</div>';
                html += '<div class="radio-btn" onclick="setFrites(\'' + id + '\', \'patate\')" id="ft-' + id + '">üç† Douces</div>';
                html += '</div>';
                html += '</div>';
                
                // SUPPL√âMENTS
                html += '<div class="section-title">‚ûï Suppl√©ments</div>';
                for (var s = 0; s < supplements.length; s++) {
                    var sup = supplements[s];
                    html += '<div class="check-line" onclick="toggleSupp(\'' + id + '\', \'' + sup.id + '\')">';
                    html += '<input type="checkbox" id="s-' + id + '-' + sup.id + '" onclick="event.stopPropagation()">';
                    html += '<div class="txt"><span>' + sup.n + '</span><span>+' + sup.p.toFixed(2) + ' CHF</span></div>';
                    html += '</div>';
                }
                
                // QUANTIT√â
                html += '<div class="qty-control">';
                html += '<button onclick="changeQty(\'' + id + '\', -1)" disabled id="min-' + id + '">-</button>';
                html += '<span id="q-' + id + '">0</span>';
                html += '<button onclick="changeQty(\'' + id + '\', 1)">+</button>';
                html += '</div>';
                
                html += '</div>';
            }
            
            document.getElementById('burgers').innerHTML = html;
            
            // Menus √©tudiants
            var menusHtml = '<div style="background:#fff;border:2px solid #000;padding:10px;margin-bottom:15px;border-radius:8px;">üéì Carte √©tudiante obligatoire</div>';
            menusHtml += renderSimple('me0', 'Menu √âtudiant M', 'Burger M + frites + soft', 14);
            document.getElementById('menus').innerHTML = menusHtml;
            
            // Desserts
            var dessertsHtml = '';
            dessertsHtml += renderSimple('d0', 'Tiramisu Classique', 'Le classique italien', 6);
            dessertsHtml += renderSimple('d1', 'Tiramisu Speculoos', 'Au go√ªt de speculoos', 6);
            dessertsHtml += renderSimple('d2', 'Tiramisu Oreo', 'Aux biscuits Oreo', 6);
            document.getElementById('desserts').innerHTML = dessertsHtml;
            
            initDate();
        }
        
        function renderSimple(id, name, desc, price) {
            var html = '<div class="item">';
            html += '<h3>' + name + '</h3>';
            html += '<p>' + desc + '</p>';
            html += '<div class="price">' + price.toFixed(2) + ' CHF</div>';
            html += '<div class="qty-control">';
            html += '<button onclick="changeQty(\'' + id + '\', -1)" disabled id="min-' + id + '">-</button>';
            html += '<span id="q-' + id + '">0</span>';
            html += '<button onclick="changeQty(\'' + id + '\', 1)">+</button>';
            html += '</div>';
            html += '</div>';
            return html;
        }
        
        // ACTIONS
        function showCat(cat, btn) {
            document.querySelectorAll('.category').forEach(function(el) { el.classList.remove('active'); });
            document.getElementById(cat).classList.add('active');
            document.querySelectorAll('.nav button').forEach(function(el) { el.classList.remove('active'); });
            btn.classList.add('active');
        }
        
        function toggleMenu(id) {
            var cb = document.getElementById('m-' + id);
            cb.checked = !cb.checked;
            updateMenu(id);
        }
        
        function updateMenu(id) {
            var cb = document.getElementById('m-' + id);
            var line = cb.parentElement;
            var frites = document.getElementById('f-' + id);
            
            if (!opts[id]) opts[id] = {menu: false, frites: null, supps: []};
            
            if (cb.checked) {
                opts[id].menu = true;
                line.classList.add('checked');
                frites.classList.add('show');
            } else {
                opts[id] = {menu: false, frites: null, supps: []};
                line.classList.remove('checked');
                frites.classList.remove('show');
                document.getElementById('fp-' + id).classList.remove('selected');
                document.getElementById('ft-' + id).classList.remove('selected');
            }
            updateTotal();
        }
        
        function setFrites(id, type) {
            if (!opts[id] || !opts[id].menu) return;
            opts[id].frites = type;
            document.getElementById('fp-' + id).classList.remove('selected');
            document.getElementById('ft-' + id).classList.remove('selected');
            document.getElementById('f' + type[0] + '-' + id).classList.add('selected');
            updateTotal();
        }
        
        function toggleSupp(id, supId) {
            var cb = document.getElementById('s-' + id + '-' + supId);
            cb.checked = !cb.checked;
            updateSupp(id, supId);
        }
        
        function updateSupp(id, supId) {
            var cb = document.getElementById('s-' + id + '-' + supId);
            var line = cb.parentElement;
            
            if (!opts[id]) opts[id] = {menu: false, frites: null, supps: []};
            
            if (cb.checked) {
                if (opts[id].supps.indexOf(supId) === -1) opts[id].supps.push(supId);
                line.classList.add('checked');
            } else {
                opts[id].supps = opts[id].supps.filter(function(s) { return s !== supId; });
                line.classList.remove('checked');
            }
            updateTotal();
        }
        
        function changeQty(id, delta) {
            if (!cart[id]) cart[id] = 0;
            cart[id] += delta;
            if (cart[id] < 0) cart[id] = 0;
            if (cart[id] > 10) cart[id] = 10;
            
            document.getElementById('q-' + id).textContent = cart[id];
            document.getElementById('min-' + id).disabled = (cart[id] === 0);
            
            // Reset si quantit√© 0
            if (cart[id] === 0 && id.startsWith('b')) {
                var idx = id.substring(1);
                // Reset menu
                var mcb = document.getElementById('m-' + id);
                if (mcb && mcb.checked) {
                    mcb.checked = false;
                    mcb.parentElement.classList.remove('checked');
                    document.getElementById('f-' + id).classList.remove('show');
                    document.getElementById('fp-' + id).classList.remove('selected');
                    document.getElementById('ft-' + id).classList.remove('selected');
                }
                // Reset supps
                for (var i = 0; i < supplements.length; i++) {
                    var scb = document.getElementById('s-' + id + '-' + supplements[i].id);
                    if (scb && scb.checked) {
                        scb.checked = false;
                        scb.parentElement.classList.remove('checked');
                    }
                }
                opts[id] = {menu: false, frites: null, supps: []};
            }
            
            updateTotal();
        }
        
        function updateTotal() {
            var total = 0, count = 0;
            for (var id in cart) {
                if (cart[id] > 0) {
                    var price = 0;
                    if (id.startsWith('b')) price = burgers[parseInt(id.substring(1))].p;
                    else if (id.startsWith('me')) price = 14;
                    else if (id.startsWith('d')) price = 6;
                    
                    var itemTotal = price * cart[id];
                    
                    if (opts[id]) {
                        if (opts[id].menu) itemTotal += 5 * cart[id];
                        for (var i = 0; i < opts[id].supps.length; i++) {
                            var sup = supplements.find(function(s) { return s.id === opts[id].supps[i]; });
                            if (sup) itemTotal += sup.p * cart[id];
                        }
                    }
                    
                    total += itemTotal;
                    count += cart[id];
                }
            }
            document.getElementById('cart-total').textContent = total.toFixed(2);
            document.getElementById('cart-count').textContent = count + (count > 1 ? ' articles' : ' article');
            document.getElementById('order-btn').disabled = (count === 0);
        }
        
        function initDate() {
            var today = new Date();
            document.getElementById('delivery-date').valueAsDate = today;
            updateTimes();
        }
        
        function updateTimes() {
            var date = document.getElementById('delivery-date').value;
            var sel = document.getElementById('delivery-time');
            sel.innerHTML = '<option value="">Choisir</option>';
            if (!date) return;
            
            var d = new Date(date);
            var now = new Date();
            var isToday = d.toDateString() === now.toDateString();
            
            var slots = ['11:30', '11:45', '12:00', '12:15', '12:30', '12:45', '13:00', '13:15', '13:30', '13:45', '14:00'];
            
            if (isToday) {
                var minTime = new Date(now.getTime() + 45 * 60000);
                var minHour = minTime.getHours();
                var minMin = minTime.getMinutes();
                slots = slots.filter(function(t) {
                    var parts = t.split(':');
                    var h = parseInt(parts[0]);
                    var m = parseInt(parts[1]);
                    return h > minHour || (h === minHour && m >= minMin);
                });
            }
            
            slots.forEach(function(t) {
                var opt = document.createElement('option');
                opt.value = t;
                opt.textContent = t;
                sel.appendChild(opt);
            });
        }
        
        function openOrder() {
            updateTimes();
            var html = '';
            var total = 0;
            
            for (var id in cart) {
                if (cart[id] > 0) {
                    var name, price;
                    if (id.startsWith('b')) { name = burgers[parseInt(id.substring(1))].n; price = burgers[parseInt(id.substring(1))].p; }
                    else if (id.startsWith('me')) { name = 'Menu √âtudiant M'; price = 14; }
                    else if (id.startsWith('d')) { name = ['Tiramisu Classique', 'Tiramisu Speculoos', 'Tiramisu Oreo'][parseInt(id.substring(1))]; price = 6; }
                    
                    var itemTotal = price * cart[id];
                    var details = [];
                    
                    if (opts[id] && opts[id].menu) {
                        itemTotal += 5 * cart[id];
                        details.push('Menu + frites ' + (opts[id].frites === 'patate' ? 'douces' : 'normales'));
                    }
                    if (opts[id] && opts[id].supps.length > 0) {
                        var snames = opts[id].supps.map(function(sid) {
                            var s = supplements.find(function(x) { return x.id === sid; });
                            return s ? s.n : '';
                        });
                        details.push('+' + snames.join(', '));
                        itemTotal += opts[id].supps.length * 2.5 * cart[id];
                    }
                    
                    total += itemTotal;
                    html += '<div style="display:flex;justify-content:space-between;padding:8px 0;border-bottom:1px solid #ddd;">';
                    html += '<div>' + cart[id] + '√ó ' + name + (details.length ? '<br><small>' + details.join(' | ') + '</small>' : '') + '</div>';
                    html += '<div>' + itemTotal.toFixed(2) + ' CHF</div>';
                    html += '</div>';
                }
            }
            
            html += '<div style="display:flex;justify-content:space-between;padding:15px 0;margin-top:10px;border-top:2px solid #000;font-weight:bold;font-size:18px;">';
            html += '<span>TOTAL</span><span>' + total.toFixed(2) + ' CHF</span></div>';
            
            document.getElementById('order-list').innerHTML = html;
            document.getElementById('orderModal').classList.add('show');
        }
        
        function closeOrder() {
            document.getElementById('orderModal').classList.remove('show');
        }
        
        function sendOrder() {
            var name = document.getElementById('name').value.trim();
            var phone = document.getElementById('phone').value.trim();
            var date = document.getElementById('delivery-date').value;
            var time = document.getElementById('delivery-time').value;
            var notes = document.getElementById('notes').value.trim();
            
            if (!name || !phone) { alert('Veuillez remplir le nom et t√©l√©phone'); return; }
            if (!date || !time) { alert('Veuillez choisir la date et l\'heure'); return; }
            
            var msg = 'üçî *COMMANDE CAFE BAR LE 31*\n\n';
            msg += 'üë§ ' + name + '\n';
            msg += 'üìû ' + phone + '\n';
            msg += 'üìÖ ' + date + ' √† ' + time + '\n';
            msg += 'üìç Avenue de la Gare 31, 2800 Del√©mont\n\n';
            msg += '*Commande:*\n';
            
            var total = 0;
            for (var id in cart) {
                if (cart[id] > 0) {
                    var itemName, basePrice;
                    if (id.startsWith('b')) { itemName = burgers[parseInt(id.substring(1))].n; basePrice = burgers[parseInt(id.substring(1))].p; }
                    else if (id.startsWith('me')) { itemName = 'Menu √âtudiant M'; basePrice = 14; }
                    else { itemName = 'Tiramisu'; basePrice = 6; }
                    
                    var lineTotal = basePrice * cart[id];
                    msg += cart[id] + '√ó ' + itemName;
                    
                    if (opts[id] && opts[id].menu) {
                        lineTotal += 5 * cart[id];
                        msg += ' +Menu(' + (opts[id].frites === 'patate' ? 'douces' : 'normales') + ')';
                    }
                    if (opts[id] && opts[id].supps.length > 0) {
                        msg += ' +' + opts[id].supps.join(',');
                        lineTotal += opts[id].supps.length * 2.5 * cart[id];
                    }
                    
                    msg += ' = ' + lineTotal.toFixed(2) + ' CHF\n';
                    total += lineTotal;
                }
            }
            
            msg += '\nüí∞ *TOTAL: ' + total.toFixed(2) + ' CHF*';
            if (notes) msg += '\n\nüìù ' + notes;
            
            window.open('https://wa.me/41783280311?text=' + encodeURIComponent(msg), '_blank');
            
            // Reset
            cart = {};
            opts = {};
            init();
            document.getElementById('name').value = '';
            document.getElementById('phone').value = '';
            document.getElementById('notes').value = '';
            closeOrder();
        }
        
        init();
    </script>
</body>
</html>
